
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
  <meta content="true" name="HandheldFriendly" />
  <meta content="width=device-width; initial-scale=1; maximum-scale=1; minimum-scale=1" name="viewport" />
  <title>HTML5 Login</title>
  <script src="/pcapp/static/js/jquery-3.1.1.min.js"></script>
  <script type="text/javascript" src="https://login.ld176988.com/jswrapper/integration.js.php?casino=winforfun88"></script>
  <script type="text/javascript">

    var username = "PT用户名";
    var password=  "PT密码";
    var lang = "zh"; //语言
    var gamecode= "anwild";  //游戏gameid


    window.onload = function () { 
        gamecode = getUrlParam("c1")//游戏code
        var tryPlay = getUrlParam("t1") == "true";
        if (tryPlay) {
            toTryPtGame();
            return;
        }
        debugger
        c2 = getUrlParam("c2");
        var sourceStr = decrypt(c2);

        username =getParamVal(sourceStr,"u1").toUpperCase();//ptUser.username
        password =getParamVal(sourceStr,"u2");//ptUser.password

        var mills =parseInt(getParamVal(sourceStr,"u3"));
        debugger
        login();
        };
    //iapiSetCallout('Login');
    iapiSetCallout('Login', calloutLogin);

    function login() {
      iapiSetClientPlatform("mobile&deliveryPlatform=HTML5");
      var realMode = 1;
      debugger
      iapiLogin(username, password, realMode, lang === "zh" ? "ch" : "en");
    }
    function calloutLogin(response) {
      if (response.errorCode) {
        alert("Login failed. " + response.playerMessage + " Error code: " + response.errorCode)

      }
      else {
        askTempandLaunchGame('thtk');
      }
    }
    function getUrlVars() {

      var vars = {};
      var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
        vars[key] = value;
      });
      return vars;

    }

    iapiSetCallout('GetTemporaryAuthenticationToken', calloutGetTemporaryAuthenticationToken);

    function askTempandLaunchGame(gamecode) {

      currentgame = gamecode;
      var realMode = 1;

      iapiRequestTemporaryToken(realMode, '424', 'GamePlay');

    }

    function launchMobileClient(temptoken) {
      var clientUrl = 'http://hub.ld176988.com/igaming/' + '?gameId=' + gamecode + '&real=1' + '&username=' + username + '&lang=' + (lang === "zh" ? "zh-cn" : "en") + '&tempToken=' + temptoken;
      document.location = clientUrl;
    }

    function calloutGetTemporaryAuthenticationToken(response) {
      if (response.errorCode) {
        alert("Token failed. " + response.playerMessage + " Error code: " + response.errorCode);
      }

      else {
        launchMobileClient(response.sessionToken.sessionToken);
      }

    }
    function getUrlParam(name) {
            try {
                var url = window.location.href;
                var paramStr=url.substring(url.lastIndexOf("/") + 1).split("?")[1];
                return getParamVal(paramStr,name);
            } catch (ex) {
                console.error(ex);
            }
        }
            
        function getParamVal(paramStr,name) {
            try {
                var array = paramStr.split("&");
                for (var i = 0; i < array.length; i++) {
                    var pvs = array[i].split("=");
                    if (name.toLowerCase() == pvs[0].trim().toLowerCase()) {
                        return pvs[1].trim();
                    }
                }
            } catch (ex) {
                console.error(ex);
            }
        }
    
        function decrypt(encrypt){
            var source = new Array();
            var i;
            var s=encrypt.split("F");
            for(i=1;i<s.length;i++){
                source+=String.fromCharCode(parseInt(s[i],10));
            }
            return source;
        }
  </script>
</html>
